"use strict";function findMonthMoney(t,e,a){$.ajax({type:"get",url:"/index/findMonthMoney",data:{year:t,month:e,userId:a},success:function(t){if(moneyData=t,totalFn(t),$("#tableData").html(""),0!=t.moneyData.length)setTable(t.moneyData);else{$("#tableData").append("<td>暂无数据</td><td>暂无数据</td><td>暂无数据</td>")}}})}function totalFn(t){$("#yaerPay").html(t.yaerMoney.toFixed(2)),$("#monthPay").html(t.monthMOney.toFixed(2)),$("#totalEarn").html(t.yearEarn.toFixed(2)).css({color:"green"}),$("#totalPay").html(t.yearPay.toFixed(2)).css({color:"red"}),$("#totalMEarn").html(t.monthEarn.toFixed(2)).css({color:"green"}),$("#totalMPay").html(t.monthPay.toFixed(2)).css({color:"red"}),t.yaerMoney>0?$("#yaerPay").css({color:"green"}):$("#yaerPay").css({color:"red"}),t.monthMOney>0?$("#monthPay").css({color:"green"}):$("#monthPay").css({color:"red"})}function setTable(t){var e=t[0].year,a=t[0].month,o=t[0].day,n=+t[0].money;if(1==t.length){s=n>0?"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="earn">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>':"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="pay">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>',$("#tableData").append(s)}for(var r=1;r<t.length;r++)if(e==t[r].year&&a==t[r].month&&o==t[r].day){if(n+=+t[r].money,r==t.length-1){s=n>0?"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="earn">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>':"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="pay">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>',$("#tableData").append(s)}}else{if(s=n>0?"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="earn">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>':"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="pay">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>',$("#tableData").append(s),n=0,e=t[r].year,a=t[r].month,o=t[r].day,n+=+t[r].money,r==t.length-1){var s;s=n>0?"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="earn">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>':"<tr><td>"+e+"-"+a+"-"+o+'</td><td><span class="pay">'+n.toFixed(2)+'</span></td><td><button type="button" class="btn btn-primary moneyDetail" data-toggle="modal" data-target=".Modal" dataTime="'+e+"-"+a+"-"+o+'">详细</button></td></tr>',$("#tableData").append(s)}}}function setCookie(t,e,a){var o=new Date;o.setDate(o.getDate()+a),document.cookie=t+"="+decodeURI(e)+(null==a?"":";expires="+o.toGMTString())}function getCookie(t){var e=null,a=null;return document.cookie.length>0&&-1!=(e=document.cookie.indexOf(t+"="))?(e=e+t.length+1,-1==(a=document.cookie.indexOf(";",e))?document.cookie.slice(e):document.cookie.slice(e,a)):""}$("#showInput").click(function(){var t=new Date;$("#time").html("当前时间:"+t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate())}),$("#account").click(function(){window.location.href="/home.html"}),$("#contact_me").click(function(){window.location.href="/contact.html"}),$("#logout").click(function(){$.ajax({type:"get",url:"/users/logout",success:function(){window.location.href="/index.html"}})});var myDate=new Date,year=myDate.getFullYear(),month=myDate.getMonth()+1,day=myDate.getDate(),moneyData=null;$("#year option[value="+year+"]").attr("selected",!0),$("#month option[value="+month+"]").attr("selected",!0);var url=window.location.href,session_user=url.slice(url.lastIndexOf("/")+1,url.lastIndexOf(".")),userData=null;"home"!=session_user&&"contact"!=session_user||$.ajax({type:"get",url:"/users/getSession",success:function(t){if(void 0==t._id)window.location.href="/index.html";else{userData=t;var e=new Date;findMonthMoney(e.getFullYear(),e.getMonth()+1,t._id)}}}),$("#submit").click(function(){var t=$("#contact_content").val();if(""==t||null==t)return $(".tip").html("内容不能为空"),void $(".tip").css({color:"#ff6d6d"});$.ajax({type:"get",url:"/index/contactme",data:{userId:userData._id,contact:t},success:function(){$(".tip").html("成功提交"),$(".tip").css({color:"green"}),$("#submit").hide()}})}),$("body").on("click",".moneyDetail",function(){$("#detailTable").html("");for(var t=$(this).attr("datatime").split("-"),e=[],a=0;a<moneyData.moneyData.length;a++)t[0]==moneyData.moneyData[a].year&&t[1]==moneyData.moneyData[a].month&&t[2]==moneyData.moneyData[a].day&&e.push(moneyData.moneyData[a]);for(a=0;a<e.length;a++){var o;o=e[a].money>0?"<tr><td>"+e[a].year+"-"+e[a].month+"-"+e[a].day+" "+e[a].time+"</td><td>"+e[a].remark+'</td><td><span class="earn">'+Number(e[a].money).toFixed(2)+"</span></td></tr>":"<tr><td>"+e[a].year+"-"+e[a].month+"-"+e[a].day+" "+e[a].time+"</td><td>"+e[a].remark+'</td><td><span class="pay">'+Number(e[a].money).toFixed(2)+"</span></td></tr>",$("#detailTable").append(o)}}),$("body").on("click",".delete",function(){var t=this,e=$(this).attr("del_id");$.ajax({type:"post",url:"index/deleteMoney",data:{id:e},success:function(){$(t).parent().parent().remove();var e=new Date;findMonthMoney(e.getFullYear(),e.getMonth()+1,userData._id)}})}),$("#search").click(function(){var t=$("#year  option:selected").val(),e=$("#month  option:selected").val(),a=$("#day  option:selected").val();a?$.ajax({type:"get",url:"/index/findDayMoney",data:{year:t,month:e,day:a,userId:userData._id},success:function(t){if(moneyData=t,totalFn(t),$("#tableData").html(""),0!=t.moneyData.length)setTable(t.moneyData);else{$("#tableData").append("<td>暂无数据</td><td>暂无数据</td><td>暂无数据</td>")}}}):findMonthMoney(t,e,userData._id)}),$("#addmoney_btn").click(function(){var t=$("#payorget>.active>input").val(),e=$("#remark").val(),a=+$("#money").val(),o=new Date,n=o.getFullYear(),r=o.getMonth()+1,s=o.getDate(),d=o.getHours()+":"+o.getMinutes()+":"+o.getSeconds();if(void 0!=t){if(""==e)return $(".typetip").html(""),void $(".remarktip").html("备注信息不能为空");if(""==a||a<=0)return $(".typetip").html(""),$(".remarktip").html(""),void $(".moneytip").html("金额不能为空和负数");t<0&&(a*=-1),$.ajax({type:"post",url:"/index/addMoney",data:{year:n,month:r,day:s,time:d,remark:e,money:a,userId:userData._id},success:function(){$(".input_money").removeClass("showInput"),$("#payorget>.active").removeClass("active"),$("#remark").val(""),$("#money").val(""),$(".typetip").html(""),$(".remarktip").html(""),$(".moneytip").html(""),$("#myModal1").modal("hide"),findMonthMoney(n,r,userData._id)}})}else $(".typetip").html("请选择账单类型")});var cook_user=getCookie("user"),cook_password=getCookie("password");""!=cook_user&&""!=cook_password&&($("#logusername").val(cook_user),$("#logpassword").val(cook_password)),$("#login_bth").click(function(){var t=$("#logusername").val(),e=$("#logpassword").val(),a=$("#remberme").is(":checked");return""==t?($(".messageuser_tip").html("用户名不能为空"),!1):""==e?($(".messagepwd_tip").html("密码不能为空"),!1):void $.ajax({type:"post",url:"/users/login",data:{username:t,pwd:e},success:function(o){1==o.status?($(".messageuser_tip").html(""),$(".messagepwd_tip").html("用户名或密码不正确")):a?(setCookie("user",t,365),setCookie("password",e,365),window.location.href="/home.html"):window.location.href="/home.html"}})});var user={content:"",sure:!1},password={content:"",sure:!1},comfirmpwd={sure:!1};$("#regname").change(function(){var t=$("#regname").val();""==t?($(".regname").html("用户名不能为空"),user.sure=!1):/^([a-z]|[0-9]){6,16}$/gi.test(t)?$.ajax({type:"get",url:"/users/validate",data:{username:t},success:function(e){0==e.status?($(".regname").html("用户名重复"),user.sure=!1):($(".regname").html(""),user.sure=!0,user.content=t)}}):($(".regname").html("用户名格式不正确"),user.sure=!1)}),$("#regpwd").change(function(){var t=$("#regpwd").val();""==t?($(".regpwd").html("密码不能为空"),password.sure=!1):/^([a-z]|[0-9]){6,16}$/gi.test(t)?($(".regpwd").html(""),password.sure=!0,password.content=t):($(".regpwd").html("密码格式不正确"),password.sure=!1)}),$("#regcompwd").change(function(){$("#regcompwd").val()!=$("#regpwd").val()?($(".regcompwd").html("密码不一致"),comfirmpwd.sure=!1):($(".regcompwd").html(""),comfirmpwd.sure=!0)}),$("#reg_bth").click(function(){user.sure&&password.sure&&comfirmpwd.sure&&$.ajax({type:"post",url:"/users/register",data:{username:user.content,password:password.content},success:function(){console.log("success"),window.location.href="/index.html"}})});